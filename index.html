<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MA-PartD CY2025 — H2458-002 Demo</title>
  <style>
    :root{--bg:#0b1220;--panel:#0f172a;--ink:#e5e7eb;--muted:#94a3b8;--border:#1e293b;--accent:#60a5fa;}
    *{box-sizing:border-box} body{margin:0;background:linear-gradient(180deg,#0b1220,#0a0f1a);color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
    header{position:sticky;top:0;z-index:10;background:rgba(10,15,26,.85);backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
    .wrap{max-width:1100px;margin:0 auto;padding:18px}
    .top{display:flex;gap:12px;align-items:center;justify-content:space-between}
    h1{font-size:18px;margin:0;font-weight:600}
    nav{display:flex;gap:8px;flex-wrap:wrap}
    .tab{border:1px solid var(--border);background:#0f172a;padding:10px 12px;border-radius:10px;cursor:pointer}
    .tab[aria-selected="true"]{border-color:#2b3b55;background:#111b2e;outline:2px solid #1d4ed8}
    main{padding:18px}
    .panel{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:14px;margin-top:14px}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .grow{flex:1 1 auto}
    .hint{color:var(--muted);font-size:13px}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{padding:9px;border-bottom:1px solid var(--border);text-align:left;font-size:14px}
    th{font-weight:600;color:var(--muted)}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;border:1px solid var(--border);background:#0b1426;font-size:12px;color:var(--muted)}
    .stat{display:grid;grid-template-columns:auto auto;gap:6px 12px}
    .hidden{display:none !important}
    .muted{color:var(--muted)}
    .kv{display:grid;grid-template-columns:160px 1fr;gap:6px 10px}
    .mono{font-family:ui-monospace,Menlo,Consolas,monospace;font-size:12px}
  </style>
</head>
<body>
  <header>
    <div class="wrap top">
      <h1>MA-PartD CY2025 — H2458-002 Demo</h1>
      <nav role="tablist" aria-label="Views">
        <button class="tab" role="tab" data-view="overview" aria-selected="true">Overview</button>
        <button class="tab" role="tab" data-view="service">Service Areas</button>
        <button class="tab" role="tab" data-view="details">Plan Details</button>
        <button class="tab" role="tab" data-view="raw">Raw JSON</button>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <section class="panel">
      <div class="hint">This page loads three JSON endpoints and shows them without navigating (no 404s). If GitHub Pages isn’t serving yet, it automatically falls back to the repo’s <span class="mono">raw.githubusercontent.com</span> URLs.</div>
      <div id="status" class="hint" style="margin-top:6px;"></div>
    </section>

    <section id="view-overview" class="panel">
      <h2 style="margin:0 0 8px 0">Plan Overview</h2>
      <div id="overview-empty" class="muted">No overview data yet.</div>
      <div id="overview" class="kv hidden"></div>
    </section>

    <section id="view-service" class="panel hidden">
      <h2 style="margin:0 0 8px 0">Service Areas (by-plan)</h2>
      <div id="service-empty" class="muted">No service area rows.</div>
      <table id="service-table" class="hidden">
        <thead><tr><th>State</th><th>County</th><th>Premium</th><th>Contract</th><th>PlanID</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>

    <section id="view-details" class="panel hidden">
      <h2 style="margin:0 0 8px 0">Plan Details</h2>
      <div id="details-empty" class="muted">No detail fields.</div>
      <div id="details" class="kv hidden"></div>
    </section>

    <section id="view-raw" class="panel hidden">
      <h2 style="margin:0 0 8px 0">Raw JSON</h2>
      <div class="hint">Click to expand each payload.</div>
      <details style="margin-top:8px">
        <summary><b>plans/H2458-002.json</b></summary>
        <pre id="raw-plans" class="mono"></pre>
      </details>
      <details style="margin-top:8px">
        <summary><b>by-plan/H2458-002.json</b></summary>
        <pre id="raw-byplan" class="mono"></pre>
      </details>
      <details style="margin-top:8px">
        <summary><b>plan-details/H2458-002.json</b></summary>
        <pre id="raw-details" class="mono"></pre>
      </details>
    </section>
  </main>

  <script>
    const PLAN_CODE = "H2458-002";
    const BASE = ""; // relative

    const ENDPOINTS = {
      plans: [
        `${BASE}years/2025/plans/${PLAN_CODE}.json`,
        `https://fitzgema.github.io/MA-PartD-CY2025/years/2025/plans/${PLAN_CODE}.json`,
        `https://raw.githubusercontent.com/fitzgema/MA-PartD-CY2025/main/years/2025/plans/${PLAN_CODE}.json`
      ],
      byplan: [
        `${BASE}years/2025/by-plan/${PLAN_CODE}.json`,
        `https://fitzgema.github.io/MA-PartD-CY2025/years/2025/by-plan/${PLAN_CODE}.json`,
        `https://raw.githubusercontent.com/fitzgema/MA-PartD-CY2025/main/years/2025/by-plan/${PLAN_CODE}.json`
      ],
      details: [
        `${BASE}years/2025/plan-details/${PLAN_CODE}.json`,
        `https://fitzgema.github.io/MA-PartD-CY2025/years/2025/plan-details/${PLAN_CODE}.json`,
        `https://raw.githubusercontent.com/fitzgema/MA-PartD-CY2025/main/years/2025/plan-details/${PLAN_CODE}.json`
      ]
    };

    const $ = s => document.querySelector(s);
    const fmt$ = n => (Number.isFinite(Number(n)) ? `$${Number(n).toFixed(2)}` : (n ?? ""));

    function setStatus(msg){ $("#status").innerHTML = msg; }
    function show(view){
      ["overview","service","details","raw"].forEach(v=>{
        document.getElementById(`view-${v}`).classList.toggle("hidden", v!==view);
        document.querySelector(`[data-view="${v}"]`).setAttribute("aria-selected", v===view ? "true":"false");
      });
      location.hash = "#"+view;
    }
    document.querySelectorAll("[data-view]").forEach(b=>b.addEventListener("click",()=>show(b.dataset.view)));

    async function fetchFirstOk(list){
      for (const url of list){
        try{
          const res = await fetch(url, {cache:"no-store"});
          if(!res.ok) throw new Error(res.status);
          return await res.json();
        }catch(_){ /* try next */ }
      }
      return null;
    }

    function renderOverview(plans, details){
      const el = $("#overview");
      const empty = $("#overview-empty");
      let row = null;
      if (Array.isArray(plans) && plans.length) row = plans[0];
      else if (details && typeof details === "object") row = details;

      if (!row){ el.classList.add("hidden"); empty.classList.remove("hidden"); return; }

      const fields = [
        ["Organization", row.organization ?? row.Organization ?? row.carrier ?? ""],
        ["Plan Name", row.marketingName ?? row.planName ?? ""],
        ["Contract", row.contractId ?? row.ContractID ?? ""],
        ["Plan ID", row.planId ?? row.PlanID ?? ""],
        ["State", row.state ?? row.State ?? ""],
        ["County", row.county ?? row.County ?? ""],
        ["Premium", fmt$(row.premium ?? row.monthlyPremium)],
        ["MOOP", row.moop ?? row.MOOP ?? ""],
        ["Star Rating", row.starRating ?? row.stars ?? ""],
        ["Type", row.type ?? row.planType ?? ""],
      ].filter(([k,v])=> v!==undefined && v!=="");

      if (!fields.length){ el.classList.add("hidden"); empty.classList.remove("hidden"); return; }

      el.innerHTML = fields.map(([k,v])=>`<div class="muted">${k}</div><div>${v}</div>`).join("");
      el.classList.remove("hidden");
      empty.classList.add("hidden");
    }

    function renderService(byplan){
      const table = $("#service-table");
      const body = $("#service-table tbody");
      const empty = $("#service-empty");
      if (!Array.isArray(byplan) || byplan.length===0){
        table.classList.add("hidden"); empty.classList.remove("hidden"); return;
      }
      const rows = byplan.map(r=>{
        const st = r.state ?? r.State ?? "";
        const cty = r.county ?? r.County ?? r.serviceAreaCounty ?? "";
        const prem = fmt$(r.premium ?? r.monthlyPremium);
        const c = r.contractId ?? r.ContractID ?? "";
        const p = r.planId ?? r.PlanID ?? "";
        return `<tr><td>${st}</td><td>${cty}</td><td>${prem}</td><td>${c}</td><td>${p}</td></tr>`;
      }).join("");
      body.innerHTML = rows;
      table.classList.remove("hidden");
      empty.classList.add("hidden");
    }

    function renderDetails(details){
      const el = $("#details");
      const empty = $("#details-empty");
      if (!details || typeof details!=="object" || Array.isArray(details)){
        el.classList.add("hidden"); empty.classList.remove("hidden"); return;
      }
      const entries = Object.entries(details);
      if (!entries.length){ el.classList.add("hidden"); empty.classList.remove("hidden"); return; }
      el.innerHTML = entries.map(([k,v])=>`<div class="muted">${k}</div><div>${typeof v==="number"?v: (typeof v==="boolean"?(v?"Yes":"No"): String(v))}</div>`).join("");
      el.classList.remove("hidden");
      empty.classList.add("hidden");
    }

    async function init(){
      setStatus("Loading JSON from GitHub Pages with automatic raw fallback…");

      const [plans, byplan, details] = await Promise.all([
        fetchFirstOk(ENDPOINTS.plans),
        fetchFirstOk(ENDPOINTS.byplan),
        fetchFirstOk(ENDPOINTS.details),
      ]);

      const statusParts = [];
      statusParts.push(`<b>plans</b>: ${plans? "OK":"missing"}`);
      statusParts.push(`<b>by-plan</b>: ${byplan? "OK":"missing"}`);
      statusParts.push(`<b>plan-details</b>: ${details? "OK":"missing"}`);
      setStatus(statusParts.join(" &nbsp;•&nbsp; "));

      renderOverview(Array.isArray(plans)?plans:null, (details && !Array.isArray(details))?details:null);
      renderService(Array.isArray(byplan)?byplan:[]);
      renderDetails(details && !Array.isArray(details)?details:{});

      $("#raw-plans").textContent = plans ? JSON.stringify(plans,null,2) : "(not found)";
      $("#raw-byplan").textContent = byplan ? JSON.stringify(byplan,null,2) : "(not found)";
      $("#raw-details").textContent = details ? JSON.stringify(details,null,2) : "(not found)";
    }

    const initial = (location.hash||"").replace("#","") || "overview";
    show(["overview","service","details","raw"].includes(initial)?initial:"overview");
    init();
  </script>
</body>
</html>
